/* ========== Design Tokens ========== */
:root{
  --bg:#0b0f1a;
  --card:#121828;
  --muted:#8a94a7;
  --text:#e9eef7;
  --accent:#ff7a00;
  --accent-2:#19c37d;
  --border:#1e293b;

  /* Breakpoints */
  --bp-mobile: 600px;     /* <600 = Phone */
  --bp-tablet: 1024px;    /* 600–1023 = Tablet */
  /* >=1024 = Desktop */
}

/* ========== Base ========== */
*{box-sizing:border-box}
html{scroll-behavior:smooth;}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  line-height:1.55;
}
.container{width:min(1100px,100%);margin:0 auto;padding:16px}

/* ========== Navigation ========== */
.nav{
  display:flex; gap:10px; flex-wrap:wrap;
  padding:12px 16px; border-bottom:1px solid var(--border);
  position:sticky; top:0; background:var(--bg); z-index:10;
}
.nav a{
  color:var(--muted); text-decoration:none; padding:10px 12px;
  border-radius:10px; font-weight:600;
}
.nav a.active,.nav a:hover{color:#111;background:var(--accent)}

/* Mobile: Nav dichter & ggf. scrollbar */
@media (max-width: calc(var(--bp-mobile) - 1px)){
  .nav{gap:8px; padding:10px 12px; overflow-x:auto}
  .nav a{padding:8px 10px; white-space:nowrap}
}

/* ========== Cards & Buttons ========== */
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  margin:12px 0;
}
.btn{
  display:inline-flex; gap:8px; align-items:center; justify-content:center;
  padding:12px 16px; border-radius:12px; border:1px solid var(--border);
  color:var(--text); text-decoration:none; min-height:44px;
  font-size:1rem; line-height:1.2; background:#1a2336; cursor:pointer;
}
.btn:hover{filter:brightness(1.06)}
.btn:focus-visible{outline:3px solid #7fb3ff; outline-offset:2px}
.btn.primary{background:var(--accent); color:#111; border-color:transparent}
.btn.dynamic.ok{background:var(--accent-2); color:#0b0f1a; border-color:transparent}
.btn.dynamic.warn{background:#ffb84d; color:#111; border-color:transparent}
.btn.dynamic.critical{background:#ff5c5c; color:#111; border-color:transparent}
.btn-row{display:flex; gap:10px; flex-wrap:wrap}
.btn-row .btn{flex:1 1 180px}

/* Buttons/Typo fein abgestuft je Breakpoint */
@media (max-width: calc(var(--bp-mobile) - 1px)){
  .btn{min-height:48px; font-size:1.05rem}
}
@media (min-width: var(--bp-tablet)){
  .btn{min-height:42px; font-size:.98rem}
}

/* ========== Headings ========== */
h1{margin:.4em 0; font-size: clamp(20px, 4.5vw, 28px)}
h2{margin:.4em 0; font-size: clamp(18px, 3.5vw, 22px)}

/* ========== Timer Layout (responsive) ========== */
.grid-2{
  display:grid; gap:12px;
  grid-template-columns: 1fr;           /* Phone: untereinander */
}
@media (min-width: var(--bp-mobile)){
  .grid-2{ grid-template-columns: 1fr 1fr } /* Tablet: 2-spaltig */
}
@media (min-width: var(--bp-tablet)){
  .grid-2{ gap:16px }                    /* Desktop: mehr Luft */
}

.time{font-size:clamp(30px, 7.5vw, 44px); font-weight:800}
.meta{opacity:.8; margin:6px 0}
.badge{
  display:inline-block; padding:6px 12px; border-radius:999px;
  font-weight:700; font-size:.9rem; margin-bottom:8px;
}
.badge.ok{background:var(--accent-2); color:#0b0f1a}
.badge.warn{background:#ffb84d; color:#111}
.badge.critical{background:#ff5c5c; color:#111; animation:pulse 1s infinite}
.badge.muted{color:var(--muted); border:1px solid var(--border); background:transparent}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}

.progress{
  position:relative; height:12px; background:#0f1524;
  border:1px solid var(--border); border-radius:999px; overflow:hidden; margin-top:8px;
}
.progress>span{display:block; height:100%; background:var(--accent); transition:width .4s ease}
.progress.warn>span{background:#ffb84d}
.progress.critical>span{background:#ff5c5c}
.progress.ok>span{background:var(--accent-2)}

/* ========== Map Layout (mit einklappbarem Panel) ========== */
.map-layout{
  display:grid; gap:12px;
  grid-template-columns: 1fr;           /* Phone: Panel unter der Karte (oder eingeklappt) */
}
.map-view{min-height:420px}
.leaflet-container-custom{
  height:100%; min-height:420px; border:1px solid var(--border);
  border-radius:12px; overflow:hidden;
}

/* Tablet: 2 Spalten (Karte + Panel) */
@media (min-width: var(--bp-mobile)) and (max-width: calc(var(--bp-tablet) - 1px)){
  .map-layout{ grid-template-columns: 3fr 2fr }
}
/* Desktop: 2 Spalten (breiter) */
@media (min-width: var(--bp-tablet)){
  .map-layout{ grid-template-columns: 2fr 1fr }
}

.map-panel{
  background:var(--card); border:1px solid var(--border);
  border-radius:12px; padding:12px; max-height:600px; overflow:auto;
}
.panel-toggle{
  display:none;
  margin:8px 0 12px 0;
}
/* Phone: Toggle sichtbar, Panel standardmäßig eingeklappt (über JS gesteuert) */
@media (max-width: calc(var(--bp-mobile) - 1px)){
  .panel-toggle{ display:block }
}

.poi-list{list-style:none; margin:0; padding:0}
.poi-list li{border-bottom:1px dashed var(--border); padding:8px 0}
.poi-head{display:flex; align-items:center; justify-content:space-between}
.poi-meta{color:var(--muted)}
.poi-geo{
  font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  opacity:.7
}

/* Dienst-Klassen */
.hidden{display:none !important}

/* ===== Log/History – Tabelle responsiv ===== */
.log-head{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:8px}
.log-filters{display:flex;gap:8px;flex-wrap:wrap}

.table{width:100%;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#0f1524}
.table-head,.table-row{
  display:grid;grid-template-columns:140px 1fr 1fr 120px;gap:8px;align-items:center;
}
.table-head{
  background:#121a2a;color:var(--muted);font-weight:700;padding:10px 12px;border-bottom:1px solid var(--border)
}
.table-row{padding:10px 12px;border-bottom:1px solid var(--border)}
.table-row:last-child{border-bottom:none}
.table-empty{padding:16px;color:var(--muted)}

.col-mode{display:flex;align-items:center;gap:8px}
.col-dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.col-dur{font-weight:700}

/* Chips/Batches für Modus */
.chip{
  display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700;font-size:.85rem;border:1px solid var(--border)
}
.chip-drive{background:var(--accent);color:#111;border:0}
.chip-break{background:#ffb84d;color:#111;border:0}

/* Mobile: untereinander stapeln */
@media (max-width: 600px){
  .table-head{display:none}
  .table-row{
    grid-template-columns:1fr; gap:6px;
    border-bottom:1px solid var(--border);
    padding:12px;
  }
  .col-mode{order:1}
  .col-dt:nth-of-type(2){order:2}
  .col-dt:nth-of-type(3){order:3}
  .col-dur{order:4}
}
/* ====== Shell & Topbar ====== */
.topbar{position:sticky; top:0; z-index:20; background:var(--bg); border-bottom:1px solid var(--border)}
.topbar-inner{display:flex; align-items:center; justify-content:space-between; padding:10px 0}
.brand{display:flex; align-items:center; gap:10px; font-weight:800; color:var(--text)}
.brand img{display:block; border-radius:6px}
.nav-top{display:none; gap:8px}
.nav-top a{color:var(--muted); text-decoration:none; padding:10px 12px; border-radius:10px; font-weight:600}
.nav-top a.active, .nav-top a:hover{color:#111; background:var(--accent)}
@media (min-width: 1024px){
  .nav-top{display:flex}
}

/* ====== Bottom Tab Bar (Smartphones) ====== */
.nav-bottom{
  position:sticky; bottom:0; z-index:30;
  display:grid; grid-template-columns:repeat(4,1fr);
  background:rgba(10,14,23,.9); backdrop-filter:saturate(1.2) blur(8px);
  border-top:1px solid var(--border);
  padding-bottom:env(safe-area-inset-bottom, 0);
}
.nav-bottom a{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:4px; padding:10px 6px; text-decoration:none; color:var(--muted); font-weight:700; min-height:56px;
}
.nav-bottom .icon{font-size:20px; line-height:1}
.nav-bottom .label{font-size:.8rem}
.nav-bottom a.active{ color:#111; background:var(--accent) }

/* Tablet/Desktop: Bottom-Nav ausblenden */
@media (min-width: 600px){
  .nav-bottom{ display:none }
}

/* Main spacing so content doesn't hide behind bottom bar on phones */
@media (max-width: 599px){
  .main-content{ padding-bottom: 76px } /* Platz für Bottom-Nav */
}

/* ====== Buttons/Typo (ergonomischer) ====== */
.btn{ min-height: 48px; font-size:1.05rem }
@media (min-width:1024px){ .btn{ min-height:42px; font-size:1rem } }

/* ====== Fokus/Accessiblity sichtbar ====== */
:focus-visible{ outline: 3px solid #7fb3ff; outline-offset: 2px }

/* ====== Kontrast-Check Hinweise (optional, nicht sichtbar) ====== */
/* Alle Primäraktionen haben #ff7a00 auf dunklem Hintergrund → Kontrast > 7:1 (AA/AAA für normal text) */

/* --- Toast & Live Region --- */
.toast{
  position:fixed; left:50%; transform:translateX(-50%);
  bottom: max(20px, env(safe-area-inset-bottom, 0));
  background:var(--accent); color:#111; padding:12px 16px; border-radius:12px;
  box-shadow:0 6px 18px rgba(0,0,0,.35); font-weight:800; z-index:9999
}
.sr-live{ position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden }

/* --- Buttons: aktive Zustände + große Touchflächen --- */
.btn:active{ transform: translateY(0.5px) }
.btn.primary, .btn.dynamic.ok, .btn.dynamic.warn, .btn.dynamic.critical{
  box-shadow: 0 6px 18px rgba(0,0,0,.25), 0 0 0 0 rgba(255,122,0,0);
  transition: box-shadow .2s ease, transform .06s ease;
}
.btn.primary:active, .btn.dynamic.ok:active, .btn.dynamic.warn:active, .btn.dynamic.critical:active{
  box-shadow: 0 4px 12px rgba(0,0,0,.25), 0 0 0 6px rgba(255,122,0,.15);
}

/* --- Reduce Motion: weniger Animationen --- */
@media (prefers-reduced-motion: reduce){
  .badge.critical{ animation: none }
  .btn, .progress>span{ transition: none }
}

/* --- Very Small Phones: Bottom-Nav Labels ausblenden --- */
@media (max-width: 360px){
  .nav-bottom .label{ display:none }
}

/* --- Safe Areas (Notch) --- */
.app-shell{ padding-bottom: env(safe-area-inset-bottom, 0) }
.topbar{ padding-top: env(safe-area-inset-top, 0) }
